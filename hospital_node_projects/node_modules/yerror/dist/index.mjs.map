{"version":3,"file":"index.mjs","names":["os","YError","wrappedErrors","errorCode","params","Array","concat","code","name","toString","Error","captureStackTrace","constructor","length","stack","EOL","join","wrap","yerrorWrap","err","yError","wrappedErrorIsACode","_looksLikeAYErrorCode","message","push","cast","yerrorCast","_looksLikeAYError","apply","bump","yerrorBump","endsWith","str","test"],"sources":["../src/index.js"],"sourcesContent":["import os from 'os';\n\n/**\n * An YError class able to contain some params and\n *  print better stack traces\n * @extends Error\n */\nclass YError extends Error {\n  /**\n   * Creates a new YError with an error code\n   *  and some params as debug values.\n   * @param {string} [errorCode = 'E_UNEXPECTED']\n   * The error code corresponding to the actual error\n   * @param {...any} [params]\n   * Some additional debugging values\n   */\n  constructor(wrappedErrors, errorCode, ...params) {\n    // Detecting if wrappedErrors are passed\n    if (!(wrappedErrors instanceof Array)) {\n      params = ('undefined' === typeof errorCode ? [] : [errorCode]).concat(\n        params,\n      );\n      errorCode = wrappedErrors;\n      wrappedErrors = [];\n    }\n\n    // Call the parent constructor\n    super(errorCode);\n\n    // Filling error\n    this.code = errorCode || 'E_UNEXPECTED';\n    this.params = params;\n    this.wrappedErrors = wrappedErrors;\n    this.name = this.toString();\n\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, this.constructor);\n    }\n  }\n\n  toString() {\n    return (\n      (this.wrappedErrors.length\n        ? // eslint-disable-next-line\n          this.wrappedErrors[this.wrappedErrors.length - 1].stack + os.EOL\n        : '') +\n      this.constructor.name +\n      ': ' +\n      this.code +\n      ' (' +\n      this.params.join(', ') +\n      ')'\n    );\n  }\n}\n\n/**\n * Wraps any error and output a YError with an error\n *  code and some params as debug values.\n * @param {Error} err\n * The error to wrap\n * @param {string} [errorCode = 'E_UNEXPECTED']\n * The error code corresponding to the actual error\n * @param {...any} [params]\n * Some additional debugging values\n * @return {YError}\n * The wrapped error\n */\nYError.wrap = function yerrorWrap(err, errorCode, ...params) {\n  let yError = null;\n  const wrappedErrorIsACode = _looksLikeAYErrorCode(err.message);\n  const wrappedErrors = (err.wrappedErrors || []).concat(err);\n\n  if (!errorCode) {\n    if (wrappedErrorIsACode) {\n      errorCode = err.message;\n    } else {\n      errorCode = 'E_UNEXPECTED';\n    }\n  }\n  if (err.message && !wrappedErrorIsACode) {\n    params.push(err.message);\n  }\n  yError = new YError(wrappedErrors, errorCode, ...params);\n  return yError;\n};\n\n/**\n * Return a YError as is or wraps any other error and output\n *  a YError with a code and some params as debug values.\n * @param {Error} err\n * The error to cast\n * @param {string} [errorCode = 'E_UNEXPECTED']\n * The error code corresponding to the actual error\n * @param {...any} [params]\n * Some additional debugging values\n * @return {YError}\n * The wrapped error\n */\nYError.cast = function yerrorCast(err, ...params) {\n  if (_looksLikeAYError(err)) {\n    return err;\n  }\n  return YError.wrap.apply(YError, [err].concat(params));\n};\n\n/**\n * Same than `YError.wrap()` but preserves the code\n *  and the debug values of the error if it is\n *  already an instance of the YError constructor.\n * @param {Error} err\n * The error to bump\n * @param {string} [errorCode = 'E_UNEXPECTED']\n * The error code corresponding to the actual error\n * @param {...any} [params]\n * Some additional debugging values\n * @return {YError}\n * The wrapped error\n */\nYError.bump = function yerrorBump(err, ...params) {\n  if (_looksLikeAYError(err)) {\n    return YError.wrap.apply(YError, [err, err.code].concat(err.params));\n  }\n  return YError.wrap.apply(YError, [err].concat(params));\n};\n\n// In order to keep compatibility through major versions\n// we have to make kind of an cross major version instanceof\nfunction _looksLikeAYError(err) {\n  return (\n    err instanceof YError ||\n    (err.constructor &&\n      err.constructor.name &&\n      err.constructor.name.endsWith('Error') &&\n      'string' === typeof err.code &&\n      _looksLikeAYErrorCode(err.code) &&\n      err.params &&\n      err.params instanceof Array)\n  );\n}\n\nfunction _looksLikeAYErrorCode(str) {\n  return /^([A-Z0-9_]+)$/.test(str);\n}\n\nexport default YError;\nexport { YError };\n"],"mappings":"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"}